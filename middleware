

# 在scrapy中的middleware中设置use_Agent和代理
import random
import base64

USER_AGENTS=[列表]
PROXIES=[{'ip_port':'127.0.0.1:0000'},
{'ip_port':'','user_passwd':user:passwd}
         {},,,,,]





class RandomUesrAgent(object):
    def process_request(self,request,sprider):
        useragent=random.choice(USER_AGENTS)
        #request.headers.setdefault('User-Agent',useragent)   #二选一
	request.headers['User-Agent']=agent



class RandomProxy(object):
    def process_request(self,request,sprider):
        proxy=random.choice(PROXIES)
        #开放代理
        if proxy['user_passwd'] is None:
            request.meta['proxy']='http://'+proxy['ip_port']
            #request.meta['proxy']='https://'+proxy['ip_port']

        else:   #私密代理
            b64.user_psw=base64.b64encode(proxy['user_passwrd'].encode('utf-8'))
            request.meta['proxy']='http://'+proxy['ip_port']
            request.headers['proxy_Authorization']='basic '+b64.user_psw.decode('utf-8')
            #'basic '有一个空格


在middlewares
在middleware中使用selenium  ！！


在settings文件中开启设置
打开DOWNER_MIDDLEWARE={'douban.middlewares.my_prox':543       #优先级值越小优先极越高,优先级不能相同
		  'douban.middlewares.my_useragent':544 }




USER_AGENT_LIST = ['zspider/0.9-dev http://feedback.redkolibri.com/',
                    'Xaldon_WebSpider/2.0.b1',
                    'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) Speedy Spider (http://www.entireweb.com/about/search_tech/speedy_spider/)',
                    'Mozilla/5.0 (compatible; Speedy Spider; http://www.entireweb.com/about/search_tech/speedy_spider/)',
                    'Speedy Spider (Entireweb; Beta/1.3; http://www.entireweb.com/about/search_tech/speedyspider/)',
                    'Speedy Spider (Entireweb; Beta/1.2; http://www.entireweb.com/about/search_tech/speedyspider/)',
                    'Speedy Spider (Entireweb; Beta/1.1; http://www.entireweb.com/about/search_tech/speedyspider/)',
                    'Speedy Spider (Entireweb; Beta/1.0; http://www.entireweb.com/about/search_tech/speedyspider/)',
                    'Speedy Spider (Beta/1.0; www.entireweb.com)',
                    'Speedy Spider (http://www.entireweb.com/about/search_tech/speedy_spider/)',
                    'Speedy Spider (http://www.entireweb.com/about/search_tech/speedyspider/)',
                    'Speedy Spider (http://www.entireweb.com)',
                    'Sosospider+(+http://help.soso.com/webspider.htm)',
                    'sogou spider',
                    'Nusearch Spider (www.nusearch.com)',
                    'nuSearch Spider (compatible; MSIE 4.01; Windows NT)',
                    'lmspider (lmspider@scansoft.com)',
                    'lmspider lmspider@scansoft.com',
                    'ldspider (http://code.google.com/p/ldspider/wiki/Robots)',
                    'iaskspider/2.0(+http://iask.com/help/help_index.html)',
                    'iaskspider',
                    'hl_ftien_spider_v1.1',
                    'hl_ftien_spider',
                    'FyberSpider (+http://www.fybersearch.com/fyberspider.php)',
                    'FyberSpider',
                    'everyfeed-spider/2.0 (http://www.everyfeed.com)',
                    'envolk[ITS]spider/1.6 (+http://www.envolk.com/envolkspider.html)',
                    'envolk[ITS]spider/1.6 ( http://www.envolk.com/envolkspider.html)',
                    'Baiduspider+(+http://www.baidu.com/search/spider_jp.html)',
                    'Baiduspider+(+http://www.baidu.com/search/spider.htm)',
                    'BaiDuSpider',
                    'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0) AddSugarSpiderBot www.idealobserver.com',
                   ]

也可以添加cookie  request.cookies='cookies'











